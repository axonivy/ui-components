pipeline {
  agent any

  options {
    buildDiscarder(logRotator(numToKeepStr: '30', artifactNumToKeepStr: '5'))
    disableConcurrentBuilds()
  }

  triggers {
    cron '@midnight'
  }


  stages {
    stage('Deploy') {
      when {
        expression { isReleasingBranch() }
      }
      steps {
        script {
          docker.build('maven-build', '-f build/icons/Dockerfile .').inside {
            maven cmd: '-ntp -f packages/icons deploy -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn'
          }
          archiveArtifacts 'packages/icons/target/ui-icons-*.zip'
        }
      }
    }
  }
}
